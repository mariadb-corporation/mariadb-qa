#!/bin/bash
set +H

ERRORS='Incorrect information in file|Table.*contains.*user defined columns in.*but|Unknown column.*in.*GENERATED.*ALWAYS.*AS|Failed to read from the|Table.*doesn.t exist in engine|Index.*has.*columns unique inside.*but|indexes inside.*which is different from the number of indexes|is marked as crashed|got error.*when reading table|got error.*from storage engine'
if [ "${1}" == "plusmode" ]; then
  #TO_SCAN='/data/1*/1*/log/*.err'  # For testing
  TO_SCAN='/data/*/*/*/*.err /data/*/*/*/*/*.err'  # /data only ftm (ref ~/scanerr+)
  grep --binary-files=text -Eio "${ERRORS}" ${TO_SCAN} 2>/dev/null
else
  TO_SCAN='/test/*/*/*.err /data/*/*/*.err /test/*/*/*/*.err /data/*/*/*/*.err /test/*/*/*/*/*.err /data/*/*/*/*/*.err'
  echo "--- Searching for various errors in all error logs: This may take a while! ---"
  grep --binary-files=text -Ei "${ERRORS}" ${TO_SCAN} 2>/dev/null
  echo "------------------------------------------------------------------------------"
fi
