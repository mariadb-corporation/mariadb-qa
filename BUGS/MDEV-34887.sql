INSTALL PLUGIN Spider SONAME 'ha_spider.so';
CREATE SERVER srv FOREIGN DATA WRAPPER MYSQL OPTIONS (SOCKET '../socket.sock',DATABASE 'test',user 'Spider',PASSWORD'');
CREATE TABLE t (c INT KEY) ENGINE=Spider;
CREATE TABLE t2 (c INT KEY) ENGINE=Spider COMMENT='WRAPPER "mysql",SRV "srv",TABLE "t"';
SET GLOBAL init_connect="a";
INSERT INTO t2 VALUES (1);
BEGIN;
SELECT * FROM t2;
SET max_statement_time=0.000001;
CACHE INDEX t PARTITION (ALL) KEY(foo) IN DEFAULT;

INSTALL PLUGIN Spider SONAME 'ha_spider.so';
CREATE SERVER s FOREIGN DATA WRAPPER mysql OPTIONS (HOST'',DATABASE'',USER'',PASSWORD'',SOCKET '../socket.sock');
SET GLOBAL wait_timeout=1;
CREATE TABLE t (c INT) ENGINE=Spider;
SELECT spider_bg_direct_sql ('SET SESSION _offset=1','','SRV "s"');
XA START 'a';
INSERT INTO t VALUES (0);
XA END 'a';
SELECT SLEEP(1);
LOAD INDEX INTO CACHE t INDEX (PRIMARY) IGNORE LEAVES;
